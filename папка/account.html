<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –°–æ–ª–Ω—ã—à–∫–æ</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      text-align: center;
    }

    h1 {
      margin-top: 30px;
    }

    section {
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    #user-info {
      font-size: 18px;
      margin-bottom: 20px;
      color: #333;
    }

    .logout-button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }

    .logout-button:hover {
      background-color: #c82333;
    }

    .home-button {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    .home-button:hover {
      background-color: #0056b3;
    }

    .cabinet-section {
      text-align: left;
      margin-top: 20px;
    }

    .cabinet-section h3 {
      margin-top: 30px;
      color: #444;
    }

    .cabinet-section p {
      color: #666;
    }
  </style>
</head>
<body>

  <a href="kiril.html" class="home-button">‚¨Ö –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>

  <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>

  <section>
    <p id="user-info">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
    <button id="logout" class="logout-button">–í—ã–π—Ç–∏</button>

    <div class="cabinet-section">
      <h3>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h3>
      <div id="cart">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...</div>
      <button onclick="checkout()" style="margin-top: 10px; background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">üßæ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>

      <h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
      <p>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —ç—Ç–∏–º!</p>
    </div>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCuiYXPdd4hhvRXAL7G2I-FzDfFfIwybmw",
      authDomain: "solnishko-e2aa7.firebaseapp.com",
      projectId: "solnishko-e2aa7",
      storageBucket: "solnishko-e2aa7.appspot.com",
      messagingSenderId: "538778915897",
      appId: "1:538778915897:web:95a42b00ee680789a9e9e8",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
  if (user) {
    document.getElementById("user-info").textContent = `–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ${user.email} `;
    renderCart();
  } else {
    window.location.href = "login.html";
  }
});

    document.getElementById("logout").addEventListener("click", () => {
      signOut(auth).then(() => {
        alert("–í—ã –≤—ã—à–ª–∏.");
        window.location.href = "login.html";
      });
    });

    // üõí –ö–æ—Ä–∑–∏–Ω–∞
    async function renderCart() {
      const user = auth.currentUser;
      if (!user) return;

      const cartRef = doc(db, "carts", user.uid);
      const cartSnap = await getDoc(cartRef);
      const cartDiv = document.getElementById("cart");

      if (!cartSnap.exists() || !cartSnap.data().items.length) {
        cartDiv.innerHTML = "<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</p>";
        return;
      }

      const items = cartSnap.data().items;
      cartDiv.innerHTML = "";
      let total = 0;

      items.forEach(item => {
        total += item.price * item.quantity;
        const block = document.createElement("div");
        block.innerHTML = `
          <strong>${item.name}</strong> ‚Äî ${item.price}‚ÇΩ √ó ${item.quantity} = ${item.price * item.quantity}‚ÇΩ<br/>
          <button onclick="decreaseQuantity('${item.id}')">‚ûñ</button>
          <button onclick="increaseQuantity('${item.id}')">‚ûï</button>
          <button onclick="removeFromCart('${item.id}')">‚ùå</button>
          <hr>
        `;
        cartDiv.appendChild(block);
      });

      cartDiv.innerHTML += `<p><strong>–ò—Ç–æ–≥–æ: ${total}‚ÇΩ</strong></p>`;
    }

    window.increaseQuantity = async (id) => {
      const user = auth.currentUser;
      const cartRef = doc(db, "carts", user.uid);
      const cartSnap = await getDoc(cartRef);
      const items = cartSnap.data().items.map(item => {
        if (item.id === id) item.quantity += 1;
        return item;
      });
      await setDoc(cartRef, { items }, { merge: true });
      renderCart();
    };

    window.decreaseQuantity = async (id) => {
      const user = auth.currentUser;
      const cartRef = doc(db, "carts", user.uid);
      const cartSnap = await getDoc(cartRef);
      const items = cartSnap.data().items.map(item => {
        if (item.id === id && item.quantity > 1) item.quantity -= 1;
        return item;
      });
      await setDoc(cartRef, { items }, { merge: true });
      renderCart();
    };

    window.removeFromCart = async (id) => {
      const user = auth.currentUser;
      const cartRef = doc(db, "carts", user.uid);
      const cartSnap = await getDoc(cartRef);
      const items = cartSnap.data().items.filter(item => item.id !== id);
      await setDoc(cartRef, { items }, { merge: true });
      renderCart();
    };

    window.checkout = async () => {
      const user = auth.currentUser;
      const cartRef = doc(db, "carts", user.uid);
      await setDoc(cartRef, { items: [] });
      alert("–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –°–ø–∞—Å–∏–±–æ!");
      renderCart();
    };
  </script>
<script>
  // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
  function displayCart() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const cartContainer = document.getElementById('cart-items');

      if (!cartContainer) {
          console.error('–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å id="cart-items"');
          return;
      }

      if (cart.length === 0) {
          cartContainer.innerHTML = '<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
          return;
      }

      let total = 0;
      cartContainer.innerHTML = '<ul style="list-style: none; padding: 0;">';
      cart.forEach(item => {
          const itemTotal = item.price * item.quantity;
          total += itemTotal;

          cartContainer.innerHTML += `
              <li style="margin-bottom: 10px;">
                  <strong>${item.name}</strong><br>
                  –¶–µ–Ω–∞: ${item.price} ‚ÇΩ √ó ${item.quantity} = <strong>${itemTotal} ‚ÇΩ</strong>
              </li>
          `;
      });
      cartContainer.innerHTML += `</ul><p><strong>–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ</strong></p>`;
  }

  // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  window.addEventListener('DOMContentLoaded', displayCart);
</script>

</body>
</html>